{% extends "templateV2.html" %} {% block title %} Servicepedia {% endblock %} {% block
    content %}


    <script>


        //Configuro el modal para esta pagina:
        function validarURL(event) {  
   
            btnSubmit = document.getElementById("btnSubmitDescription");
            OpcionRegistro=btnSubmit.innerText

            if(OpcionRegistro=='Create'){
            

            var code = event.keyCode || event.which;

            if ( code == 13 || code == 9 ) {
                event.preventDefault();

                textocreateUrlBox = document.getElementById("createUrl");
                urlDescripcion=textocreateUrlBox.value
            
                function successSearch(data){
                    entries=Object.entries(data)  
                    descripcionesList=entries['0'][1] 
                    numeroReg=entries[1][1]  


                    var myModal = new bootstrap.Modal(document.getElementById('notificationBox'),{});
                    $('#notificationBoxLabel').text("Information")
                    $('#notificationBody').text("Una descripcion con este URI ya existe.")
                    $('#notificationAcceptBtn').text("Accept")
                    $('#notificationAcceptBtn').hide();

                    
                    $('#createUrl').val("");
                    myModal.show();

                }

                $.ajax({
                    method: 'POST',
                    url: '/description'+'/'+textocreateUrlBox,
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify({"url":urlDescripcion})
                }).done(successSearch);



            
          }

        
        }
    }

        //Defino el evento de accept del modal: (En este caso submit a form)
        $( "#notificationAcceptBtn" ).click(function() {
            var form=$( "#FormDescription" )
            form.submit();
            
            
          });

        function muestraIngresarPA(event){
            if(event.type=='click'){
                
                if($("#createPA").prop('disabled')){
                    $("#createPA").prop('disabled', false);
                    $("#addNewPA").prop('disabled', true);
                }else{
                    $("#createPA").prop('disabled', true);
                    $("#addNewPA").prop('disabled', false);
                    
                }
            }

        }
        
    </script>


   


<div class="col">
    <form class="form-inline my-2 my-lg-0" id="FormDescription" action="/website/registrar" method="POST" >




        <div class="grid-container">

            <div class="row" style="padding: 10px;">
                <h4> Register a new description</h4>
            </div>
            <div class="row">
                <div class="form-floating">

                    {% if description is defined %}
                    <input type="text" class="form-control" id="title" name="createTitle" value="{{description.title}}"
                        placeholder="createTitle" required>
                    {% else %}
                    <input type="text" class="form-control" id="title" name="createTitle" placeholder="createTitle" required>
                    {% endif %}
                    <label for="floatingInput">Title</label>
                    <div class="valid-feedback">Username field is valid!</div>
                    <div class="invalid-feedback">Username field cannot be blank!</div>

                    
                </div>
            </div>

            <div class="row">

                <div class="form-floating mb-3">

                    {% if description is defined %}
                    <textarea class="form-control" placeholder="Description" name="createDescription"
                        id="createDescription" style="min-height: 150px;" required>{{description.description}}</textarea>
                    {% else %}
                    <textarea class="form-control" placeholder="Description" name="createDescription"
                        id="createDescription" style="min-height: 150px;" required></textarea>
                    {% endif %}

                    <label for="floatingTextarea">Description</label>
                </div>
            </div>

            <div class="row">
                <div class="col-6">
                    <div class="form-floating mb-3">

                        {% if description is defined %}
                        <input class="form-control" name="createKeywords" value="{{description.keywords}}"
                            id="createKeywords" placeholder="Keywords" required>
                        {% else %}
                        <input class="form-control" name="createKeywords" id="createKeywords" placeholder="Keywords" required>
                        {% endif %}





                        <label for="floatingInput">Keywords</label>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="input-group mb-3">
                        <div class="input-group-append">
                            <label class="input-group-text" for="inputGroupSelect02">Public Administration</label>
                        </div>

                        {% if description is defined %}
                        <select class="custom-select" name="createPA" id="createPA" style="min-width: 30vw;max-width: 100vw;" required>
                            <option></option>
                            {% for itemPA in publicsa %}
                            <option {% if description.padministration == itemPA %}selected{% endif %}
                                value='{{ itemPA }}'>{{ itemPA }}</option>
                            {% endfor %}
                        </select>
                        {% else %}
                        <select class="custom-select" name="createPA" id="createPA" style="min-width: 30vw;" required>
                            <option selected></option>
                            {% for itemPA in publicsa %}
                            <option value='{{ itemPA }}'>{{ itemPA }}</option>
                            {% endfor %}
                        </select>
                        {% endif %}
                        <button
                            class="btn bi-plus-circle"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#addPublicAdministration"
                            aria-expanded="false"
                            aria-controls="collapseExample"
                            onclick="muestraIngresarPA(event)"
                        >
                    </div>
                    
                </div>
               
            </div>

            <div class="collapse" id="addPublicAdministration">
                <div class="input-group mb-3">
                    <div class="input-group-append">
                        <label class="input-group-text" for="inputGroupSelect02" >Add New</label>
                    </div>
                    <input class="form-control" name="addNewPA" id="addNewPA" placeholder="Public Administration Name" disabled=true required>      
                    
                </div>
            </div>


        </div>

        <div class="form-floating mb-3">

            {% if description is defined %}
            <input type="url" class="form-control" name="createUrl" value="{{description.url}}" id="createUrl"
                placeholder="url" onkeydown="validarURL(event)" readonly=true required>
            {% else %}
            <input type="url" class="form-control" name="createUrl" id="createUrl"  onkeydown="validarURL(event)"  placeholder="url" required>
            {% endif %}


            <label for="floatingInput">Public service website address.</label>
        </div>




        <div class="row">
            <div class="item2"><input type="hidden" name="usr" id="userId" value="{{ user.email }}"
                    style="width: 200px;margin:0px 10px 10px 0px;" class="form-control mr-sm-4" placeholder="User."
                    readonly />
            </div>
        </div>

        
        <div class="row" style=" display: inline-flexbox;">

                <button class="btn btn-secondary" id="btnSubmitDescription" style="width: 200px;"  type="submit" >
                    {% if description is defined %}
                    Edit
                    {% else %}
                    Create
                    {% endif %}
                </button>
            
                <a  href="/dashboard"   style="width: 200px;padding-left: 10px;margin-left: 10px;" 
                    class="btn btn-secondary active"  >
                    Cancel
                </a>   
    
              
        </div>
  


    
        
</div>


</form>
</div>





{% endblock %}